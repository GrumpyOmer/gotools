# gotools
##### Language: ğŸ‡¨ğŸ‡³ | [ğŸ‡ºğŸ‡¸](./README-EN.md)
[![OSCS Status](https://www.oscs1024.com/platform/badge/GrumpyOmer/gotools.svg?size=small)](https://www.oscs1024.com/project/GrumpyOmer/gotools?ref=badge_small)
#### æ³¨ï¼šä¸€äº›åœ¨ä½¿ç”¨golangæœŸé—´å°è£…çš„æå‡æ•ˆç‡çš„å°å·¥å…·
#### ï¼ˆæ¨èä½¿ç”¨golang 1.16åŠä»¥ä¸Šç‰ˆæœ¬ï¼Œéƒ¨åˆ†ä¾èµ–æœ‰ç‰ˆæœ¬é™åˆ¶ï¼‰
## ç®€ä»‹
## Installation
```
    go get github.com/GrumpyOmer/gotools@latest
```
## Module List
ã€Œ  
&ensp;&ensp;&ensp;[goroutine](#goroutine)  
&ensp;&ensp;&ensp;[mysql](#mysql)  
&ensp;&ensp;&ensp;[redis](#redis)  
&ensp;&ensp;&ensp;[es](#es)  
&ensp;&ensp;&ensp;[configController](#configController)  
&ensp;&ensp;&ensp;[download](#download)  
&ensp;&ensp;&ensp;[logCenter](#logCenter)  
ã€
# <span id="goroutine"><- goroutine -></span>
### *åŸºäºä»»åŠ¡åˆ†å‘çš„åç¨‹æ± *
##### å¼•å…¥æ—¶å…ˆè¿›è¡ŒåŒ…åˆå§‹åŒ–ï¼Œè¿™å°†ä¼šåˆå§‹åŒ–åç¨‹ä»»åŠ¡çš„æ¶ˆè´¹çº¿ç¨‹
```
    _ "github.com/GrumpyOmer/gotools/goroutine"
```
##### ä½¿ç”¨ä¹‹å‰éœ€è¦æ ¹æ®å®é™…æƒ…å†µå»è®¾ç½®åç¨‹çš„æœ€å¤§æ•°é‡ï¼Œé€šè¿‡è°ƒç”¨  SetGoroutineNumber(uint64)  æ–¹æ³•
```
    SetGoroutineNumber(CPUCoreNum)
```
##### ä½¿ç”¨æ—¶é€šè¿‡è°ƒç”¨  MakeTask(func(), *sync.WaitGroup) error  æ–¹æ³•ã€‚éœ€è¦å°†ä¸šåŠ¡é€»è¾‘å°è£…è¿› func() å‡½æ•°å†…ï¼Œä»¥åŠç”Ÿæˆçš„ç®¡æ§ä¸šåŠ¡é€»è¾‘çš„WaitGroupä¸¤ä¸ªä½œä¸ºå‚æ•°ä¼ é€’è¿›å»ï¼Œè¯¥æ–¹æ³•ä¼šå“åº”ä¸€ä¸ªerroræ¥å‘ŠçŸ¥åº”ç”¨å±‚ä»»åŠ¡æ˜¯å¦æˆåŠŸä¸¢è¿›åç¨‹æ± (ä»»åŠ¡æ‰§è¡Œæ˜¯å¼‚æ­¥çš„)ï¼Œå¤–éƒ¨å¦‚æœæœ‰ä¸šåŠ¡éœ€è¦å¿…é¡»è‡ªå·±ç”¨ç­‰å¾…ç»„çš„Wait()æ–¹æ³•å»ç­‰å¾…ä¸šåŠ¡æ‰§è¡Œç»“æŸã€‚
##### æ‰§è¡Œå®Œæˆåï¼Œéœ€è¦é€šè¿‡è‡ªè¡Œè·å–ä¼ å…¥çš„ func() å‡½æ•°å†…éƒ¨çš„erroræ¥åšåˆ°ä¸šåŠ¡å±‚é¢çš„åˆ¤æ–­ï¼Œæ¥è¾¾åˆ°ä¸šåŠ¡å±‚é¢é¢„æœŸçš„æ•ˆæœï¼Œä½¿ç”¨ä¾‹å­å¦‚ä¸‹ï¼š
```
    var (
        a int
        b int
        err1 error
        err2 error
        w = sync.WaitGroup{}
        tempFunc1 = func() {
            b = a+1
            //è‡ªè¡Œä¼ å…¥é”™è¯¯å’Œæ•æ‰é”™è¯¯
            err1 = errors.New("this is a demo")
        }
        
        tempFunc2 = func() {
            b = a+1
            //è‡ªè¡Œä¼ å…¥é”™è¯¯å’Œæ•æ‰é”™è¯¯
            err2 = errors.New("this is a demo")
        }
    )
    w.Add(2)
    if test1:= goroutine.MakeTask(tempFunc1, &w); test1 != nil {
        // ä¸‹å‘å¤±è´¥
        w.Done()
        fmt.Println(test1)
    }
    
    if test2:= goroutine.MakeTask(tempFunc2, &w); test2 != nil {
        // ä¸‹å‘å¤±è´¥
        w.Done()
        fmt.Println(test2)
    }
    
    w.Wait()
    fmt.Println(a)
    fmt.Println(b)
    //è‡ªè¡Œæ•è·è¿å¸¦func()ä¸€èµ·ä¼ å…¥åç¨‹æ± çš„err
    fmt.Println(err1)
    fmt.Println(err2)
```

# <span id="mysql"><- mysql -></span>
### *åŸºäºgormå°è£…çš„ä¸€å¥—mysqlç»„ä»¶*
##### é¦–å…ˆåœ¨ä½¿ç”¨ä¹‹å‰ï¼Œéœ€è¦é€šè¿‡ConfigInit([]byte)æ–¹æ³•æŠŠdbçš„é…ç½®ä»¥åŸºäºjsonå­—ç¬¦ä¸²è½¬æ¢åçš„[]byteæ ¼å¼ä¼ é€’è¿›æ¥ï¼Œè½¬æ¢å‰çš„jsonæ ¼å¼å¦‚ä¸‹ (æ”¯æŒä¸€ä¸»å¤šä»ï¼Œé…ç½®è‡ªå®šä¹‰æ ¹æ®è‡ªèº«éœ€æ±‚ä¸»åº“ä»åº“éƒ½èƒ½ç•™ç©º)ï¼š
```json
 {
    "master": {
        "user": "x",
        "pass": "x",
        "ip": 123,
        "port": 456,
        "db_name": "x",
        "max_igle_conn": 1, // è®¾ç½®ç©ºé—²è¿æ¥æ± ä¸­è¿æ¥çš„æœ€å¤§æ•°é‡
        "max_open_conn": 1, // è®¾ç½®æ‰“å¼€æ•°æ®åº“è¿æ¥çš„æœ€å¤§æ•°é‡
        "conn_max_life_time": 1 // è®¾ç½®äº†è¿æ¥å¯å¤ç”¨çš„æœ€å¤§æ—¶é—´/ç§’
        },
    "slave": [
        {
           "user": "x",
           "pass": "x",
           "ip": 123,
           "port": 456,
           "db_name": "x",
           "max_igle_conn": 1, // è®¾ç½®ç©ºé—²è¿æ¥æ± ä¸­è¿æ¥çš„æœ€å¤§æ•°é‡
           "max_open_conn": 1, // è®¾ç½®æ‰“å¼€æ•°æ®åº“è¿æ¥çš„æœ€å¤§æ•°é‡
           "conn_max_life_time": 1 // è®¾ç½®äº†è¿æ¥å¯å¤ç”¨çš„æœ€å¤§æ—¶é—´/ç§’
        }
    ]
 }
```
##### å®ä¾‹çš„åˆå§‹åŒ–ä¼šåœ¨ä¸»ä»åº“å„è‡ªç¬¬ä¸€æ¬¡è°ƒç”¨GetMaster()å’ŒGetSlave()æ—¶è¿›è¡Œï¼Œåˆå§‹åŒ–æˆåŠŸåè¿æ¥æ± ç›¸å…³é…ç½®ä¹Ÿä¼šå»ºç«‹ï¼Œåç»­å†è°ƒç”¨ä»¥ä¸Šä¸¤ä¸ªæ–¹æ³•å°±ä¼šç›´æ¥ä»è¿æ¥æ± ç§è·å–å¯¹åº”å®ä¾‹çš„é•¿è¿æ¥ä»¥ä¾›åº”ç”¨å±‚ä½¿ç”¨äº†


# <span id="redis"><- redis -></span>
### *åŸºäºredigoå°è£…çš„ä¸€å¥—redisç»„ä»¶*
##### ä½¿ç”¨é€»è¾‘æ–¹å¼ä¸ä¸Šé¢çš„mysqlå¤§è‡´ç›¸åŒ(åˆå§‹åŒ–ï¼Œè·å–ä¸»ä»å®ä¾‹æ–¹æ³•éƒ½ä¸€æ ·)ï¼Œä¹Ÿæ˜¯åŸºäºredigoå®ç°çš„ä¸€å¥—è¿æ¥æ± ï¼Œåªä¸è¿‡jsoné…ç½®ä¸åŒï¼Œä»¥ä¸‹ç»™å‡ºå¯¹åº”çš„jsonæ ¼å¼ï¼š
```json
 {
    "master": {
        "host": "",
        "port": "",
        "user": "", // å…¼å®¹redis 6.0æ”¯æŒç”¨æˆ·åç™»å½•
        "pass": "",
        "auth": "",
        "db": 0,
        "network": "tcp",
        "max_idle": 1, // æœ€å¤§çš„ç©ºé—²è¿æ¥æ•°ï¼Œè¡¨ç¤ºå³ä½¿æ²¡æœ‰redisè¿æ¥æ—¶ä¾ç„¶å¯ä»¥ä¿æŒNä¸ªç©ºé—²çš„è¿æ¥ï¼Œè€Œä¸è¢«æ¸…é™¤ï¼Œéšæ—¶å¤„äºå¾…å‘½çŠ¶æ€ã€‚
        "max_active": 1, // æœ€å¤§çš„æ¿€æ´»è¿æ¥æ•°ï¼Œè¡¨ç¤ºåŒæ—¶æœ€å¤šæœ‰Nä¸ªè¿æ¥
        "idle_timeout": 1 // æœ€å¤§çš„ç©ºé—²è¿æ¥ç­‰å¾…æ—¶é—´ï¼Œè¶…è¿‡æ­¤æ—¶é—´åï¼Œç©ºé—²è¿æ¥å°†è¢«å…³é—­ / ç§’
        },
    "slave": [
        {
           "host": "x",
           "port": "x",
           "user": "x", // å…¼å®¹redis 6.0æ”¯æŒç”¨æˆ·åç™»å½•
           "pass": "x",
           "auth": "",
           "db": 0,
           "network": "tcp",
           "max_idle": 1, // æœ€å¤§çš„ç©ºé—²è¿æ¥æ•°ï¼Œè¡¨ç¤ºå³ä½¿æ²¡æœ‰redisè¿æ¥æ—¶ä¾ç„¶å¯ä»¥ä¿æŒNä¸ªç©ºé—²çš„è¿æ¥ï¼Œè€Œä¸è¢«æ¸…é™¤ï¼Œéšæ—¶å¤„äºå¾…å‘½çŠ¶æ€ã€‚
           "max_active": 1, // æœ€å¤§çš„æ¿€æ´»è¿æ¥æ•°ï¼Œè¡¨ç¤ºåŒæ—¶æœ€å¤šæœ‰Nä¸ªè¿æ¥
           "idle_timeout": 1 // æœ€å¤§çš„ç©ºé—²è¿æ¥ç­‰å¾…æ—¶é—´ï¼Œè¶…è¿‡æ­¤æ—¶é—´åï¼Œç©ºé—²è¿æ¥å°†è¢«å…³é—­ / ç§’
        },
    ]
 }
```
##### æ³¨æ„: è·å–åˆ°çš„è¿æ¥ä½¿ç”¨ç»“æŸåéœ€è¦åº”ç”¨å±‚æ‰‹åŠ¨è°ƒç”¨Close()æ–¹æ³•æ”¾å›è¿æ¥æ± ï¼Œä¸ç„¶ä¼šå¯¼è‡´è¿æ¥æ± å†…å­˜æ³„æ¼
##### è·å–åˆ°è¿æ¥åçš„cmdæ“ä½œå‚è€ƒredigoæ–‡æ¡£ï¼šhttps://pkg.go.dev/github.com/gomodule/redigo/redis#hdr-Connections

# <span id="es"><- es -></span>
### *åŸºäº olivere/elastic å°è£…çš„ä¸€å¥—esç»„ä»¶*
##### ä½¿ç”¨é€»è¾‘æ–¹å¼ä¸ä¸Šé¢çš„mysql/rediså¤§è‡´ç›¸åŒ(åˆå§‹åŒ–ï¼Œesä¸éœ€è¦åŒºåˆ†ä¸»ä»æœåŠ¡ï¼Œåªéœ€è¦é…ç½®é‡ŒæŠŠé›†ç¾¤æœºå™¨çš„ip:portéƒ½é…ç½®å¥½)ï¼Œä»¥ä¸‹ç»™å‡ºå¯¹åº”çš„jsonæ ¼å¼ï¼š
```json
 {
    "address": [
      "http://127.0.0.1:9200",
      "http://127.0.0.2:9200",
      "http://127.0.0.3:9200"
    ]
 }
```
##### è·å–åˆ°è¿æ¥åçš„cmdæ“ä½œå‚è€ƒæ–‡æ¡£ï¼šhttps://pkg.go.dev/github.com/olivere/elastic#section-readme


# <span id="configController"><- configController -></span>
### *å¤šç§æ–¹å¼å®ç°æœ¬åœ°é…ç½®æ–‡ä»¶çƒ­æ›´æ–°*
##### æ”¯æŒæœ¬åœ°é…ç½®æ–‡ä»¶çš„çƒ­æ›´æ–°ï¼ˆä¿®æ”¹é…ç½®æ–‡ä»¶ç›®å½•æˆ–é…ç½®æ–‡ä»¶å†…å®¹ï¼‰
##### é¡¹ç›®åˆå§‹åŒ–æ—¶å¿…é¡»å¼•å…¥åŒ…åˆå§‹åŒ–ï¼Œè¿™å°†ä¼šåˆå§‹åŒ–é…ç½®ä»»åŠ¡çš„ç›‘å¬è€…ï¼ˆå®ç°çƒ­æ›´æ–°ï¼‰ï¼Œå°±åƒè¿™æ ·ï¼š
```
    _ "github.com/GrumpyOmer/gotools/configController"
```
ç›®å‰æ”¯æŒjson/xml/.envä¸‰ç§é…ç½®æ–‡ä»¶æ ¼å¼,åˆå§‹åŒ–åå¯é€šè¿‡å¯¹åº”çš„æ–¹æ³•è·å–
```
    GetJsonField(field string)
    GetXmlField(field string)
    GetEnvField(field string)
```
é…ç½®çš„çƒ­æ›´æ–°é™¤äº†æ”¯æŒæ‰‹åŠ¨ä¿®æ”¹é…ç½®æ–‡ä»¶å†…å®¹ï¼Œè¿˜æ”¯æŒåœ¨ç¨‹åºåŠ¨æ€è¿è¡Œè¿‡ç¨‹ä¸­è°ƒç”¨ä»¥ä¸‹æ–¹æ³•ä¿®æ”¹é…ç½®æ–‡ä»¶åç§°æˆ–ç›®å½•æ¥è§¦å‘æ›´æ–°
```
    // è‡ªå®šä¹‰é…ç½®ç›®å½•
    SetPubDir(path string)
    // è‡ªå®šä¹‰xmlæ–‡ä»¶å
    SetXmlConfigName(configName string)
    // è‡ªå®šä¹‰jsonæ–‡ä»¶å
    SetJsonConfigName(configName string)
    // è‡ªå®šä¹‰.envæ–‡ä»¶å
    SetEnvConfigName(configName string)
```
é…ç½®æ–‡ä»¶å†…å®¹æ ¼å¼å¦‚ä¸‹: 
```
    [json] :
    `
    {
      "test1": "1",
      "test2": "2"
    }
    `
    
    [xml] :
    `
    <?xml version="1.0" encoding="UTF-8" ?>
    <root>              //xmlé…ç½®æ–‡ä»¶å¿…é¡»ä»¥rootä½œä¸ºæ ¹å…ƒç´ ï¼Œå¦åˆ™æ— æ³•è§£æ
        <test1>1</test1>
        <test2>2</test2>
    </root>
    `
    
    [.env] :
    `
    test1="1"
    test2="2"
    `
    ä»¥ä¸ŠæˆåŠŸåºåˆ—åŒ–åä¸ºä»¥ä¸‹map
    map[string]string{
        "test1": "1",
        "test2": "2",
    }
```
# <span id="download"><- download -></span>
### *æ–‡ä»¶ä¸‹è½½ç»„ä»¶*
##### æ–‡ä»¶ä¸‹è½½ç»„ä»¶ï¼Œæ”¯æŒå®æ—¶ä¸‹è½½è¿›åº¦æŸ¥è¯¢
```
    å®æ—¶ä¸‹è½½è¿›åº¦æŸ¥è¯¢,å†…éƒ¨ç”¨åç¨‹å¼‚æ­¥å¤„ç†
    wc:= NewWc()
    wc.DownloadFile(filepath string, url string) error
    filepath: ä¿å­˜è·¯å¾„+æ–‡ä»¶å
    url: è¿œç¨‹å›¾ç‰‡url
    error: åªéœ€è¦å…³æ³¨ä¸‹erræ˜¯å¦è¿”å›å½“å‰wcå·²åœ¨ä½¿ç”¨ä¸­ ï¼ˆä¸€ä¸ªwcå¯¹è±¡åŒæ—¶åªèƒ½æ”¯æŒä¸€ä¸ªæ–‡ä»¶ä¸‹è½½ï¼Œæ‰¹é‡åŒæ—¶ä¸‹è½½å¯ä»¥åˆ›å»ºå¤šä¸ªwcå¯¹è±¡ï¼‰
```
å›¾ç‰‡æ–‡ä»¶ä¸‹è½½è¿‡ç¨‹ä¸­å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹æ³•å®æ—¶è§‚å¯Ÿè¿›åº¦
```
    è·å–æ–‡ä»¶ä¸‹è½½ç™¾åˆ†æ¯” ï¼ˆ%ï¼‰
    wc.FetchProgress() int32 
    è·å–æ–‡ä»¶ä¸‹è½½å®é™…å¤§å° ï¼ˆBytesï¼‰
    wc.FetchCurrent() uint64 
    è·å–æ–‡ä»¶æ€»å¤§å° ï¼ˆBytesï¼‰
    wc.FetchTotal() uint64
    è·å–æ–‡ä»¶æ˜¯å¦ä¸‹è½½æˆåŠŸ ï¼ˆbool, error messageï¼‰
    wc.DownloadRes() (bool, error)
```
# <span id="logCenter"><- logCenter -></span>
### *æ—¥å¿—ç»„ä»¶*
##### ä»¥è¯¦ç»†çš„æ ¼å¼è®°å½•ä¸‹ä»£ç é‡Œçš„æ—¥å¿—ä¿¡æ¯ 
##### ç›®å‰ç‰ˆæœ¬ä¸ºäº†è‡ªå·±æ–¹ä¾¿ä½¿ç”¨ï¼Œæ—¥å¿—åªæœ‰ä¸€ç§ä»¥å†™æ–‡ä»¶çš„æ–¹å¼ä¿å­˜åœ¨å¯åŠ¨æ–‡ä»¶ç›®å½•ä¸‹çš„logç›®å½•ä¸‹ï¼ˆæ ¹æ®æ—¥æœŸåˆ’åˆ†æ–‡ä»¶ï¼‰,åç»­ä¼šæŠŠç»„ä»¶æ¥å…¥è¿›æ¥ï¼ˆes, mysqlç­‰ï¼‰
```
    {
        "Content":"omer test1",                                                     // æ—¥å¿—å†…å®¹
        "Location":"D:/server/gotools/logCenter/config_init_test.go:9",             // æ—¥å¿—æ‰“å°ä½ç½®(æ–‡ä»¶/è¡Œ)  
        "FunctionName":"github.com/GrumpyOmer/gotools/logCenter.TestConfigInit",    // æ—¥å¿—æ‰“å°å‡½æ•°å
        "LogTime":"2022-09-19 18:24:05.5941501 +0800 CST m=+0.006999901"            // æ—¥å¿—æ‰“å°æ—¶é—´
    }
```
ä½¿ç”¨éå¸¸ç®€å•ï¼Œåªéœ€è¦è°ƒç”¨Add(string)å‡½æ•°æŠŠæ—¥å¿—å†…å®¹ä¼ é€’è¿›å»ï¼Œä¼šæœ‰åç¨‹å¼‚æ­¥çš„å»è®°å½•è¿™äº›æ—¥å¿—ï¼Œä¸å¿…æ‹…å¿ƒå†™æ—¥å¿—å½±å“ä¸šåŠ¡æ€§èƒ½
```
    Add("omer test1")
```
# tagæ›´æ–°è®°å½•
# v1.0.1
##### feat: åŠŸèƒ½å‘å¸ƒ
# v1.0.2
##### feat: add logCenter
# v1.1.1
##### feat: é…ç½®çš„çƒ­æ›´æ–°æ–°å¢.envç±»å‹æ–‡ä»¶